{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block map %}
 <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map_canvas { height: 100% }
    </style>
    <script type="text/javascript"
      src="http://maps.googleapis.com/maps/api/js?key={{ key }}&sensor=true">
    </script>
    <script type="text/javascript">
      var directionsDisplay;
      var directionsService = new google.maps.DirectionsService();
      var map;
      var start_index = 1;
      var end_index = 0;
      function initialize() {
        directionsDisplay = new google.maps.DirectionsRenderer();
        var myOptions = {
          {% if center %}  
          center: new google.maps.LatLng({{ center['lat'] }}, {{ center['long'] }}),
          {% else %}
          center: new google.maps.LatLng(39.9524116516, -75.1905136108),
          {% endif %}
          zoom: 14,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        map = new google.maps.Map(document.getElementById("map_canvas"),
            myOptions);
        {% for location in locations %}
	var {{ location['name'] | safe}} = new google.maps.Marker({
	    position: new google.maps.LatLng({{ location['lat'] }},{{ location['long'] }}),
	    map: map,
	    title:"{{ location['name'] | safe}}"
	    });
	{% endfor %}
        {% if bounds %}
        var bounds = new google.maps.LatLngBounds();
        bounds.extend(new google.maps.LatLng({{ bounds['min_lat'] }},
{{ bounds['min_long'] }}))
        bounds.extend(new google.maps.LatLng({{ bounds['max_lat']}},
{{ bounds['max_long'] }}))
        map.fitBounds(bounds);
        {% endif %}
        directionsDisplay.setMap(map);
      }

      function calcRoute() {
        {% if locations %}
        var start = new google.maps.LatLng({{ locations[1]['lat'] }},
        {{ locations[1]['long'] }});
        var end = new google.maps.LatLng({{ locations[0]['lat'] }},
        {{ locations[0]['long'] }});
        {% endif %}
        var request = {
        origin:start,
        destination:end,
        travelMode: google.maps.TravelMode.WALKING
        };
        directionsService.route(request, function(result, status) {
          if (status == google.maps.DirectionsStatus.OK) {
            directionsDisplay.setDirections(result);
          }
        });
      }
    </script>
{% endblock %}
{% block header %}Welcome {{ user['firstName'] + " " + user['lastName'] }}{% endblock %}
{% block content %}
<p><a href="{{ url_for('settings') }}">Settings</a></p>
<p><a href="{{ url_for('logout') }}">Log out</a></p>
<p> Start: {{ start }}, End: {{ end }} </p>
<button onclick="calcRoute()">PRESS ME!</button>
<div id="map_canvas" style="width: 1000px; height: 500px"></div>
{% for checkin in checkins %}
<p>Location: <a href="http://foursquare.com/user/{{ user['id'] }}/checkin/{{ checkin['id'] }}">{{ checkin['name'] }}</a>,  Lat: {{ checkin['lat']}}, Long: {{checkin['long']}}
 </p>
{% endfor %}
{% endblock %}